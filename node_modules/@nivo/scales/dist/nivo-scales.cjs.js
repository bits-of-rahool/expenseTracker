"use strict";var e=require("lodash/uniq.js"),t=require("lodash/uniqBy.js"),n=require("lodash/sortBy.js"),r=require("lodash/last.js"),a=require("lodash/isDate.js"),i=require("d3-time-format"),o=require("d3-scale"),u=require("d3-interpolate"),c=require("d3-time");function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(null,arguments)}var l=[function(e){return e.setMilliseconds(0)},function(e){return e.setSeconds(0)},function(e){return e.setMinutes(0)},function(e){return e.setHours(0)},function(e){return e.setDate(1)},function(e){return e.setMonth(0)}],d={millisecond:[],second:l.slice(0,1),minute:l.slice(0,2),hour:l.slice(0,3),day:l.slice(0,4),month:l.slice(0,5),year:l.slice(0,6)},f=function(e){return function(t){return d[e].forEach((function(e){e(t)})),t}},m=function(e){var t=e.format,n=void 0===t?"native":t,r=e.precision,a=void 0===r?"millisecond":r,o=e.useUTC,u=void 0===o||o,c=f(a);return function(e){if(void 0===e)return e;if("native"===n||e instanceof Date)return c(e);var t=u?i.utcParse(n):i.timeParse(n);return c(t(e))}},v=function(e,t,n,r){var a,i,c,s,l=e.min,d=void 0===l?0:l,f=e.max,m=void 0===f?"auto":f,v=e.stacked,y=void 0!==v&&v,x=e.reverse,h=void 0!==x&&x,g=e.clamp,S=void 0!==g&&g,k=e.nice,T=void 0!==k&&k,M=e.round,b=void 0===M||M;"auto"===d?a=!0===y?null!=(i=t.minStacked)?i:0:t.min:a=d;"auto"===m?c=!0===y?null!=(s=t.maxStacked)?s:0:t.max:c=m;var w=o.scaleLinear().range("x"===r?[0,n]:[n,0]).interpolate(b?u.interpolateRound:u.interpolateNumber).domain(h?[c,a]:[a,c]).clamp(S);return!0===T?w.nice():"number"==typeof T&&w.nice(T),p(w,y)},p=function(e,t){void 0===t&&(t=!1);var n=e;return n.type="linear",n.stacked=t,n},y=function(e,t,n){var r=o.scalePoint().range([0,n]).domain(t.all);return r.type="point",r},x=function(e,t,n,r){var a=e.round,i=void 0===a||a,u=o.scaleBand().range("x"===r?[0,n]:[n,0]).domain(t.all).round(i);return h(u)},h=function(e){var t=e;return t.type="band",t},g=function(e,t,n){var r,a,i=e.format,u=void 0===i?"native":i,c=e.precision,s=void 0===c?"millisecond":c,l=e.min,d=void 0===l?"auto":l,f=e.max,v=void 0===f?"auto":f,p=e.useUTC,y=void 0===p||p,x=e.nice,h=void 0!==x&&x,g=m({format:u,precision:s,useUTC:y});r="auto"===d?g(t.min):"native"!==u?g(d):d,a="auto"===v?g(t.max):"native"!==u?g(v):v;var S=y?o.scaleUtc():o.scaleTime();S.range([0,n]),r&&a&&S.domain([r,a]),!0===h?S.nice():"object"!=typeof h&&"number"!=typeof h||S.nice(h);var k=S;return k.type="time",k.useUTC=y,k},S=function(e,t,n,r){var a,i=e.base,u=void 0===i?10:i,c=e.min,s=void 0===c?"auto":c,l=e.max,d=void 0===l?"auto":l;if(t.all.some((function(e){return 0===e})))throw new Error("a log scale domain must not include or cross zero");var f,m,v=!1;if(t.all.filter((function(e){return null!=e})).forEach((function(e){v||(void 0===a?a=Math.sign(e):Math.sign(e)!==a&&(v=!0))})),v)throw new Error("a log scale domain must be strictly-positive or strictly-negative");f="auto"===s?t.min:s,m="auto"===d?t.max:d;var p=o.scaleLog().domain([f,m]).rangeRound("x"===r?[0,n]:[n,0]).base(u).nice();return p.type="log",p},k=function(e,t,n,r){var a,i,u=e.constant,c=void 0===u?1:u,s=e.min,l=void 0===s?"auto":s,d=e.max,f=void 0===d?"auto":d,m=e.reverse,v=void 0!==m&&m;a="auto"===l?t.min:l,i="auto"===f?t.max:f;var p=o.scaleSymlog().constant(c).rangeRound("x"===r?[0,n]:[n,0]).nice();!0===v?p.domain([i,a]):p.domain([a,i]);var y=p;return y.type="symlog",y},T=function(e){return"x"===e?"y":"x"},M=function(e,t){return e===t},b=function(e,t){return e.getTime()===t.getTime()};function w(e,t,n,r){switch(e.type){case"linear":return v(e,t,n,r);case"point":return y(0,t,n);case"band":return x(e,t,n,r);case"time":return g(e,t,n);case"log":return S(e,t,n,r);case"symlog":return k(e,t,n,r);default:throw new Error("invalid scale spec")}}var E=function(e,t,n){var r;if("stacked"in n&&n.stacked){var a=e.data["x"===t?"xStacked":"yStacked"];return null==a?null:n(a)}return null!=(r=n(e.data[t]))?r:null},D=function(e,t,n){return{x:q(e,"x",t),y:q(e,"y",n)}},q=function(a,i,o,u){var c=void 0===u?{}:u,s=c.getValue,l=void 0===s?function(e){return e.data[i]}:s,d=c.setValue,f=void 0===d?function(e,t){e.data[i]=t}:d;if("linear"===o.type)a.forEach((function(e){e.data.forEach((function(e){var t=l(e);t&&f(e,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var v=m(o);a.forEach((function(e){e.data.forEach((function(e){var t=l(e);t&&f(e,v(t))}))}))}var p=[];switch(a.forEach((function(e){e.data.forEach((function(e){p.push(l(e))}))})),o.type){case"linear":var y=n(e(p).filter((function(e){return null!==e})),(function(e){return e}));return{all:y,min:Math.min.apply(Math,y),max:Math.max.apply(Math,y)};case"time":var x=t(p,(function(e){return e.getTime()})).slice(0).sort((function(e,t){return t.getTime()-e.getTime()})).reverse();return{all:x,min:x[0],max:r(x)};default:var h=e(p);return{all:h,min:h[0],max:r(h)}}},C=function(e,t,n){var i=T(e),o=[];t[i].all.forEach((function(t){var u=a(t)?b:M,c=[];n.forEach((function(n){var a=n.data.find((function(e){return u(e.data[i],t)})),s=null,l=null;if(void 0!==a){if(null!==(s=a.data[e])){var d=r(c);void 0===d?l=s:null!==d&&(l=d+s)}a.data["x"===e?"xStacked":"yStacked"]=l}c.push(l),null!==l&&o.push(l)}))})),t[e].minStacked=Math.min.apply(Math,o),t[e].maxStacked=Math.max.apply(Math,o)},j=function(e,t){return C("x",e,t)},U=function(e,t){return C("y",e,t)},P=c.timeInterval((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),O=c.timeInterval((function(e){return e.setUTCHours(0,0,0,0)}),(function(e,t){return e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),B={millisecond:[c.timeMillisecond,c.utcMillisecond],second:[c.timeSecond,c.utcSecond],minute:[c.timeMinute,c.utcMinute],hour:[c.timeHour,c.utcHour],day:[P,O],week:[c.timeWeek,c.utcWeek],sunday:[c.timeSunday,c.utcSunday],monday:[c.timeMonday,c.utcMonday],tuesday:[c.timeTuesday,c.utcTuesday],wednesday:[c.timeWednesday,c.utcWednesday],thursday:[c.timeThursday,c.utcThursday],friday:[c.timeFriday,c.utcFriday],saturday:[c.timeSaturday,c.utcSaturday],month:[c.timeMonth,c.utcMonth],year:[c.timeYear,c.utcYear]},A=Object.keys(B),F=new RegExp("^every\\s*(\\d+)?\\s*("+A.join("|")+")s?$","i");exports.castBandScale=h,exports.castLinearScale=p,exports.castPointScale=function(e){var t=e;return t.type="point",t},exports.centerScale=function(e){var t=e.bandwidth();if(0===t)return e;var n=t/2;return e.round()&&(n=Math.round(n)),function(t){var r;return(null!=(r=e(t))?r:0)+n}},exports.compareDateValues=b,exports.compareValues=M,exports.computeScale=w,exports.computeXYScalesForSeries=function(e,t,n,r,a){var i=e.map((function(e){return function(e){return s({},e,{data:e.data.map((function(e){return{data:s({},e)}}))})}(e)})),o=D(i,t,n);"stacked"in t&&!0===t.stacked&&j(o,i),"stacked"in n&&!0===n.stacked&&U(o,i);var u=w(t,o.x,r,"x"),c=w(n,o.y,a,"y"),l=i.map((function(e){return s({},e,{data:e.data.map((function(e){return s({},e,{position:{x:E(e,"x",u),y:E(e,"y",c)}})}))})}));return s({},o,{series:l,xScale:u,yScale:c})},exports.createBandScale=x,exports.createDateNormalizer=m,exports.createLinearScale=v,exports.createLogScale=S,exports.createPointScale=y,exports.createPrecisionMethod=f,exports.createSymlogScale=k,exports.createTimeScale=g,exports.generateSeriesAxis=q,exports.generateSeriesXY=D,exports.getOtherAxis=T,exports.getScaleTicks=function(e,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in e){var n=t.match(F);if(n){var r=n[1],a=n[2],i=B[a][e.useUTC?1:0];if("day"===a){var o,u,c=e.domain(),s=c[0],l=c[1],d=new Date(l);return d.setDate(d.getDate()+1),null!=(o=null==(u=i.every(Number(null!=r?r:1)))?void 0:u.range(s,d))?o:[]}if(void 0===r)return e.ticks(i);var f=i.every(Number(r));if(f)return e.ticks(f)}throw new Error("Invalid tickValues: "+t)}if("ticks"in e){if(void 0===t)return e.ticks();if("number"==typeof(m=t)&&isFinite(m)&&Math.floor(m)===m)return e.ticks(t)}var m;return e.domain()},exports.precisionCutOffs=l,exports.precisionCutOffsByType=d,exports.stackAxis=C,exports.timePrecisions=["millisecond","second","minute","hour","day","month","year"];
//# sourceMappingURL=nivo-scales.cjs.js.map
